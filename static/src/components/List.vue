//List.vue 列表
<template>
<div>

  <div id="loadingToast" v-if="showload">
      <div class="weui-mask_transparent"></div>
      <div class="weui-toast">
      <i class="weui-loading weui-icon_toast"></i>
      </div>
  </div>


  <div class="weui-panel__bd">
    
         
      <ListItem :article="article"  v-for="article in articles" :key="article.id"></ListItem>
    
  </div>
  
    <infinite-loading @infinite="infiniteHandler" :distance="distance" ref="infiniteLoading">

    <div slot="spinner" class="weui-loadmore">
        <i class="weui-loading"></i>
    </div>

    <div slot="no-results" class="weui-loadmore weui-loadmore_line">
      <span class="weui-loadmore__tips">加载不出内容!</span>
    </div>

    <div slot="no-more" class="weui-loadmore weui-loadmore_line">
      <span class="weui-loadmore__tips">到底了!</span>
    </div>


    </infinite-loading> 


    
    <div class="refresh"  v-on:click="refresh">
      <svg class="icon" width="30px" height="30.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path fill="rgba(0, 8, 255, 0.50)" d="M838.695385 374.153846A354.619077 354.619077 0 0 0 512 157.538462a354.461538 354.461538 0 1 0 0 708.923076 354.579692 354.579692 0 0 0 330.161231-225.20123 39.384615 39.384615 0 1 1 73.334154 28.750769A433.309538 433.309538 0 0 1 512 945.230769C272.738462 945.230769 78.769231 751.261538 78.769231 512S272.738462 78.769231 512 78.769231c144.423385 0 275.140923 71.286154 354.461538 183.965538V177.230769a39.384615 39.384615 0 0 1 78.769231 0v236.307693a39.266462 39.266462 0 0 1-39.384615 39.384615h-196.923077a39.384615 39.384615 0 0 1 0-78.769231h129.772308z" /></svg>
      <!-- <svg class="icon" width="30px" height="30.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path fill="rgba(0, 8, 255, 0.57)" d="M958.174805 481.820654c-1.017166-35.661198-5.421476-91.061972-32.872688-144.119375L774.270309 509.142929l125.009132 0c0.002047 0.827855 0.00307 1.650593 0.00307 2.51017 0 213.726709-173.881213 387.607922-387.607922 387.607922-213.727733 0-387.608945-173.881213-387.608945-387.607922 0-210.105229 181.584662-387.608945 396.521942-387.608945 39.323611 0 78.106916 5.861498 115.27442 17.421788l17.693987-56.888661c-42.902112-13.343913-87.639013-20.10899-132.968407-20.10899-60.358693 0-119.340015 11.80486-175.303608 35.0861-54.135968 22.520923-102.939487 54.68139-145.05263 95.588055-42.355667 41.141002-75.673493 88.934518-99.028411 142.051273-24.360827 55.404867-36.713156 114.100688-36.713156 174.459381 0 119.447463 46.515407 231.745085 130.977054 316.207755C279.929504 912.322501 392.227126 958.837908 511.674589 958.837908c119.447463 0 231.745085-46.515407 316.207755-130.977054s130.977054-196.760293 130.977054-316.207755C958.859397 499.757165 958.672132 490.187205 958.174805 481.820654z" /></svg> -->
    </div>
     <!-- <div class="category">
      <router-link class="weui-agree__text" :to="{ name: 'guide'}">
        <svg class="icon" width="30px" height="30.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path fill="rgba(0, 8, 255, 0.50)" d="M929.375 193.336l-4.875-1.333c-269.75-73.542-555-73.583-825 0l-4.875 1.333C38.917 208.544 0 259.461 0 317.211v389.583c0 57.75 38.917 108.667 94.625 123.875l4.875 1.333c134.958 36.792 273.708 55.167 412.542 55.167 138.75 0 277.542-18.375 412.417-55.167l4.917-1.333c11.375-3.083 18.083-14.792 15-26.167-3.083-11.333-14.583-17.958-26.167-15l-4.958 1.333c-262.417 71.583-539.917 71.583-802.5 0l-4.875-1.333c-37.208-10.167-63.208-44.167-63.208-82.708V317.211c0-38.542 26-72.542 63.208-82.708l4.875-1.333c262.5-71.583 540.042-71.583 802.542 0l4.875 1.333c37.208 10.125 63.167 44.167 63.167 82.708v389.583c0 11.792 9.542 21.333 21.333 21.333 11.792 0 21.333-9.542 21.333-21.333V317.211c-0.001-57.75-38.918-108.667-94.626-123.875zM444.797 548.427H553.51c17 78.539 87.01 137.594 170.552 137.594 8.87 0 17.562-0.659 26.073-1.945V612.94a105.63 105.63 0 0 1-26.073 3.258c-57.823 0-104.703-46.883-104.703-104.706 0-57.846 46.88-104.732 104.703-104.732 57.849 0 104.734 46.885 104.734 104.732 0 8.992-1.141 17.708-3.286 26.044h71.135a173.161 173.161 0 0 0 1.948-26.044c0-96.245-78.281-174.526-174.531-174.526-44.833 0-85.766 17.008-116.708 44.898v-44.909H374.99v325.193L290.823 556.18c35.823-19.214 60.188-57.008 60.188-100.505v-2.326c0-64.245-52.068-116.331-116.312-116.352l-135.819-0.041V686.01h69.812V569.659h47.255l83.635 116.357h94.354v-0.005h50.859V548.427z m0-141.659h139.75c-16.818 22.349-28.396 48.849-32.901 77.664H444.797v-77.664z m-163.932 52.357c0 25.703-20.833 46.542-46.542 46.542h-65.63v-98.898h65.63c25.708 0 46.542 20.836 46.542 46.539v5.817zM851.172 739.628V638.583h101.042l-64.297-64.299h-75.073l-75.781-75.789c-7.177-7.177-18.802-7.177-25.979 0s-7.177 18.802 0 25.979l75.786 75.792v75.06l64.302 64.302z" /></svg>
        <!-- <svg class="icon" width="30px" height="30.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path fill="rgba(0, 8, 255, 0.57)" d="M63.97608 877.236402 63.97608 723.281007l894.866944 0 0 153.955394L63.97608 877.236402zM63.97608 434.615539l894.866944 0 0 153.955394L63.97608 588.570933 63.97608 434.615539zM63.97608 145.949047l894.866944 0L958.843024 299.903417 63.97608 299.903417 63.97608 145.949047z" /></svg>   -->
        <!-- <svg class="icon" width="30px" height="30.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path fill="rgba(0, 8, 255, 0.50)" d="M490.816 698.133333a21.354667 21.354667 0 0 1-4.906667 2.986667l-176.938666 78.442667c-50.133333 19.797333-89.109333-18.773333-70.549334-69.802667l0.917334-2.176 84.138666-170.090667a21.333333 21.333333 0 0 1 3.434667-5.013333c0.896-1.493333 1.984-2.88 3.264-4.16l422.378667-422.4a64 64 0 0 1 90.496 0l75.434666 75.434667a64 64 0 0 1 0 90.517333L496.106667 694.250667a21.333333 21.333333 0 0 1-5.290667 3.882666z m-130.24-139.413333l-82.432 166.656c-5.461333 15.829333-0.234667 20.586667 14.336 14.826667l172.928-76.650667-104.832-104.832z m135.530667 75.178667l316.8-316.778667-105.6-105.6-316.8 316.8 105.6 105.6z m346.944-346.944l45.269333-45.269334a21.333333 21.333333 0 0 0 0-30.165333L812.885333 136.106667a21.333333 21.333333 0 0 0-30.165333 0L737.472 181.333333l105.6 105.6zM896 454.272a21.333333 21.333333 0 0 1 42.666667 0V789.333333a149.333333 149.333333 0 0 1-149.333334 149.333334H234.666667a149.333333 149.333333 0 0 1-149.333334-149.333334V234.666667a149.333333 149.333333 0 0 1 149.333334-149.333334h338.496a21.333333 21.333333 0 1 1 0 42.666667H234.666667a106.666667 106.666667 0 0 0-106.666667 106.666667v554.666666a106.666667 106.666667 0 0 0 106.666667 106.666667h554.666666a106.666667 106.666667 0 0 0 106.666667-106.666667V454.272z" /></svg> -->
        <!-- <svg class="icon" width="30px" height="30.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path fill="rgba(0, 8, 255, 0.50)" d="M1024 512C1024 229.230208 794.769792 0 512 0 229.230208 0 0 229.230208 0 512 0 794.769792 229.230208 1024 512 1024 629.410831 1024 740.826187 984.331046 830.768465 912.686662 841.557579 904.092491 843.33693 888.379234 834.742758 877.590121 826.148587 866.801009 810.43533 865.021658 799.646219 873.615827 718.470035 938.277495 618.001779 974.048781 512 974.048781 256.817504 974.048781 49.951219 767.182496 49.951219 512 49.951219 256.817504 256.817504 49.951219 512 49.951219 767.182496 49.951219 974.048781 256.817504 974.048781 512 974.048781 599.492834 949.714859 683.336764 904.470807 755.960693 897.177109 767.668243 900.755245 783.071797 912.462793 790.365493 924.170342 797.659191 939.573897 794.081058 946.867595 782.373508 997.013826 701.880796 1024 608.898379 1024 512ZM533.078812 691.418556C551.918022 691.418556 567.190219 706.673952 567.190219 725.511386L567.190219 734.541728C567.190219 753.370677 552.049365 768.634558 533.078812 768.634558L533.078812 768.634558C514.239601 768.634558 498.967405 753.379162 498.967405 734.541728L498.967405 725.511386C498.967405 706.682436 514.108258 691.418556 533.078812 691.418556L533.078812 691.418556ZM374.634146 418.654985C374.634146 418.654985 377.308518 442.210609 403.631972 442.210609 429.955424 442.210609 431.511799 418.654985 431.511799 418.654985 429.767552 342.380653 465.107535 306.162338 537.45591 309.760186 585.612324 315.19693 610.562654 342.380653 612.231066 391.391309 608.894242 413.21824 590.617557 441.441342 558.083539 475.90071 515.008196 519.47462 493.470524 558.49126 493.470524 592.950626L493.470524 628.289468C493.470524 628.289468 496.775846 649.365867 520.582206 649.365867 544.388565 649.365867 547.693888 628.289468 547.693888 628.289468L547.693888 603.744164C547.693888 574.961397 568.321517 540.342125 609.652612 500.28611 652.879629 460.469948 674.341463 424.091729 674.341463 391.391309 670.777131 300.725594 623.530758 253.473886 532.223166 249.796087 427.189099 248.037141 374.634146 304.323439 374.634146 418.654985Z" /></svg> -->
      <!--</router-link>
    </div>  -->


</div>


</template>
<style>

.refresh{
    width:30px;
    height: 30px;
    line-height: 30px;
    bottom: 50px;
    right: 30px;
    z-index: 10;
    position: fixed;
    cursor: pointer;
}
.category{
    width:30px;
    height: 30px;
    line-height: 30px;
    bottom: 10px;
    right: 30px;
    z-index: 10;
    position: fixed;
    cursor: pointer;
} 
.article-title{
  
    line-height: 1.2;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
    font-size: 15px;
    color: #000;

}
.article-tags{
margin-top: 10px
}
</style>
<script>

import InfiniteLoading from 'vue-infinite-loading'
// import api from '../api/api.js';
import ListItem from './ListItem';
import api from '../api';

export default {
  
  name: 'ArticleList',
  
  
    components: {
      InfiniteLoading,
      ListItem
    },

    props: ['cate'],

    data () {
      return {
        // swiperOption: {
        //   slidesPerView: 'auto',
        //   initialSlide: 0,
        //   resistanceRatio: .00000000000001,
        //   slideToClickedSlide: true
        // },
        articles: [],
        distance: 200,
        page:0,
        showload:false,
        rank:0, // 当前下拉文章最低rank
        loading:false,
      }
    },
    mounted() {
      // this.articles = JSON.parse(window.localStorage.getItem("articles"))||[]
      // this.rank = parseFloat(window.localStorage.getItem("rank")) || 0
      // alert(this.cate)
    },
    methods: {



        refresh:function(){
          var site = this
          setTimeout(function(){
            site.articles= []
            site.rank=0
            site.$refs.infiniteLoading.stateChanger.reset()
          }, 50);
          return true
        },

        infiniteHandler: function ($state) {
          var site = this
          if(!site.loading){
            if (this.articles.length > 500) {
              $state.complete();
            } else {
              /** load data start */
              setTimeout(function(){
                site.loading = true
                var uri = '/hot?limit=10&rank='+site.rank+'&tag='+site.cate;
                api.get(uri,function(err,data){
                  if(data && data.length>0){
                    for(var t=0;t<data.length;t++){
                      site.articles.push(data[t])
                    }
                    site.rank = data[(data.length-1)].Rank
                    $state.loaded();
                    site.page ++
                  }else{
                    $state.complete();
                  }
                  site.loading = false // 加载完成
                })
              }, 200);
              /** load data end */
            }
          }
        },

    },


    watch:{
      articles:function(){
        // localStorage.setItem("articles",JSON.stringify(this.articles))
        // localStorage.setItem("rank",this.rank)
      },
      cate:function(){
          var __cate = parseInt(window.localStorage.getItem("__cate")) || 0
          // console.log(__cate,this.cate)
          if( __cate!=parseInt(this.cate) ){
            localStorage.setItem("__cate",this.cate)
            // console.log('refresh...',this.cate)
            this.refresh()
          }

      }
    }
}
</script>



